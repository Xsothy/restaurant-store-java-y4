<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{fragments/layout :: head('Order Details - Restaurant Store')}"></th:block>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Kantumruy Pro', sans-serif;
        }
        .status-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .status-PENDING { background-color: #fef3c7; color: #92400e; }
        .status-CONFIRMED { background-color: #dbeafe; color: #1e40af; }
        .status-PREPARING { background-color: #ede9fe; color: #5b21b6; }
        .status-READY { background-color: #e0e7ff; color: #3730a3; }
        .status-OUT_FOR_DELIVERY { background-color: #cffafe; color: #0f766e; }
        .status-COMPLETED { background-color: #dcfce7; color: #166534; }
        .status-CANCELLED { background-color: #fee2e2; color: #991b1b; }
        .status-DELIVERED { background-color: #dcfce7; color: #166534; }
        .payment-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.35rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .payment-PENDING { background-color: #fef3c7; color: #92400e; }
        .payment-PROCESSING { background-color: #e0f2fe; color: #1e40af; }
        .payment-COMPLETED { background-color: #dcfce7; color: #166534; }
        .payment-FAILED { background-color: #fee2e2; color: #991b1b; }
        .payment-CANCELLED { background-color: #f1f5f9; color: #475569; }
        .payment-REFUNDED { background-color: #ede9fe; color: #5b21b6; }
        .order-tracking-wrapper {
            position: relative;
        }
        .order-tracking-timeline {
            position: relative;
            padding-left: 2.5rem;
        }
        .order-tracking-timeline::before {
            content: '';
            position: absolute;
            left: 0.95rem;
            top: 0.25rem;
            bottom: 0.25rem;
            width: 2px;
            background: linear-gradient(180deg, rgba(191, 219, 254, 0.6), rgba(147, 197, 253, 0.8));
        }
        .tracking-step {
            position: relative;
            padding-left: 1.25rem;
            padding-bottom: 1.5rem;
        }
        .tracking-step:last-child {
            padding-bottom: 0;
        }
        .tracking-marker {
            position: absolute;
            left: -0.95rem;
            top: 0;
            width: 1.9rem;
            height: 1.9rem;
            border-radius: 9999px;
            border: 3px solid #bfdbfe;
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
            color: #1e3a8a;
            transition: all 0.3s ease;
        }
        .tracking-step-upcoming .tracking-marker {
            border-color: #e2e8f0;
            color: #94a3b8;
        }
        .tracking-step-completed .tracking-marker {
            border-color: #bbf7d0;
            background-color: #bbf7d0;
            color: #166534;
            box-shadow: 0 10px 25px -15px rgba(22, 101, 52, 0.75);
        }
        .tracking-step-active .tracking-marker {
            border-color: #3b82f6;
            background-color: #2563eb;
            color: #ffffff;
            box-shadow: 0 10px 25px -12px rgba(37, 99, 235, 0.65);
        }
        .tracking-step-cancelled .tracking-marker {
            border-color: #fecaca;
            background-color: #fecaca;
            color: #991b1b;
            box-shadow: 0 10px 25px -15px rgba(185, 28, 28, 0.6);
        }
        .tracking-connector {
            display: none;
        }
        @media (min-width: 768px) {
            .order-tracking-wrapper {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            .order-tracking-timeline {
                display: grid;
                grid-template-columns: repeat(6, minmax(0, 1fr));
                gap: 1.5rem;
                padding-left: 0;
                padding-top: 1rem;
            }
            .order-tracking-timeline::before {
                display: none;
            }
            .tracking-step {
                padding-left: 0;
                padding-bottom: 0;
                text-align: center;
            }
            .tracking-marker {
                position: relative;
                left: auto;
                margin: 0 auto 0.75rem;
            }
            .tracking-connector {
                position: absolute;
                top: 1.05rem;
                left: 50%;
                right: -50%;
                height: 2px;
                background: linear-gradient(90deg, rgba(191, 219, 254, 0.6), rgba(147, 197, 253, 0.8));
                z-index: -1;
            }
            .tracking-step:last-child .tracking-connector {
                display: none;
            }
            .tracking-step-completed .tracking-connector {
                background: linear-gradient(90deg, rgba(187, 247, 208, 0.8), rgba(74, 222, 128, 0.8));
            }
            .tracking-step-active .tracking-connector {
                background: linear-gradient(90deg, rgba(59, 130, 246, 0.7), rgba(37, 99, 235, 0.7));
            }
            .tracking-step-cancelled .tracking-connector {
                background: linear-gradient(90deg, rgba(252, 165, 165, 0.8), rgba(248, 113, 113, 0.8));
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <th:block th:replace="~{fragments/layout :: header}"></th:block>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 py-8" th:if="${order}">
        <div class="mb-6" th:if="${successMessage}">
            <div class="rounded-lg border border-green-200 bg-green-50 px-4 py-3 text-green-700" th:text="${successMessage}"></div>
        </div>
        <div class="mb-6" th:if="${errorMessage}">
            <div class="rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-red-700" th:text="${errorMessage}"></div>
        </div>

        <div class="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300 overflow-hidden" th:attr="data-order-id=${order.id}">
            <div class="p-6 border-b border-gray-100">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Order Details</h1>
                        <p class="text-sm text-gray-500 mt-1">Placed on
                            <span th:text="${#temporals.format(order.createdAt, 'MMM dd, yyyy HH:mm')}"></span>
                        </p>
                    </div>
                    <span class="status-badge" th:classappend="' status-' + ${order.status}" th:text="${order.status}"
                          th:attr="data-status-badge=${order.id}"></span>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600 mt-4">
                    <div>
                        <span class="font-medium">Order ID:</span>
                        <span th:text="${'#' + order.id}" class="ml-2"></span>
                    </div>
                    <div>
                        <span class="font-medium">Order Type:</span>
                        <span th:text="${order.orderType}" class="ml-2"></span>
                    </div>
                    <div>
                        <span class="font-medium">Total Amount:</span>
                        <span th:text="${#numbers.formatDecimal(order.totalPrice, 0, 'COMMA', 0, 'POINT') + '៛'}"
                              class="ml-2 font-bold text-lg text-red-600"></span>
                    </div>
                    <div th:if="${order.estimatedDeliveryTime != null}">
                        <span class="font-medium">Estimated Delivery:</span>
                        <span th:text="${#temporals.format(order.estimatedDeliveryTime, 'MMM dd, yyyy HH:mm')}"
                              class="ml-2"></span>
                    </div>
                </div>
            </div>

            <div class="p-6 border-b border-gray-100 order-tracking-wrapper"
                 th:with="trackingStatuses=${T(java.util.Arrays).asList(
                        T(com.restaurant.store.entity.OrderStatus).PENDING,
                        T(com.restaurant.store.entity.OrderStatus).CONFIRMED,
                        T(com.restaurant.store.entity.OrderStatus).PREPARING,
                        T(com.restaurant.store.entity.OrderStatus).READY,
                        T(com.restaurant.store.entity.OrderStatus).OUT_FOR_DELIVERY,
                        T(com.restaurant.store.entity.OrderStatus).DELIVERED
                 )},
                 currentIndex=${trackingStatuses.contains(order.status) ? trackingStatuses.indexOf(order.status) : -1}">
                <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4 mb-6">
                    <div>
                        <h2 class="text-lg font-semibold text-gray-900">Order Tracking</h2>
                        <p class="text-sm text-gray-500"
                           th:attr="data-tracking-description=${order.id}"
                           th:text="${order.status == T(com.restaurant.store.entity.OrderStatus).CANCELLED
                                ? 'This order was cancelled before completion.'
                                : 'Follow your order from the kitchen to your door.'}"></p>
                    </div>
                    <div class="text-sm text-gray-500 flex items-center gap-2"
                         th:attr="data-order-updated-container=${order.id}"
                         th:classappend="${order.updatedAt == null} ? ' hidden' : ''">
                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>Last update</span>
                        <span class="font-medium text-gray-700"
                              th:text="${order.updatedAt != null ? #temporals.format(order.updatedAt, 'MMM dd, yyyy HH:mm') : ''}"
                              th:attr="data-order-updated=${order.id}"></span>
                    </div>
                </div>

                <div class="order-tracking-timeline"
                     th:attr="data-tracking='${order.id}', data-tracking-status='${order.status}'">
                    <div th:each="step, iterStat : ${trackingStatuses}"
                         th:with="stepIndex=${iterStat.index}"
                         th:class="${'tracking-step ' +
                                (order.status == T(com.restaurant.store.entity.OrderStatus).CANCELLED
                                    ? (stepIndex == 0 ? 'tracking-step-cancelled' : 'tracking-step-upcoming')
                                    : (currentIndex > stepIndex
                                        ? 'tracking-step-completed'
                                        : (currentIndex == stepIndex ? 'tracking-step-active' : 'tracking-step-upcoming')))}"
                         th:attr="data-tracking-step=${step.name()}">
                        <div class="tracking-marker" th:text="${stepIndex + 1}"></div>
                        <div class="tracking-connector" aria-hidden="true"></div>
                        <div class="space-y-1">
                            <p class="font-semibold text-gray-800" th:text="${#strings.replace(step.name(), '_', ' ')}"></p>
                            <p class="text-sm text-gray-500" th:switch="${step}">
                                <span th:case="${T(com.restaurant.store.entity.OrderStatus).PENDING}">We've received your order and are awaiting confirmation.</span>
                                <span th:case="${T(com.restaurant.store.entity.OrderStatus).CONFIRMED}">Your order has been confirmed by our team.</span>
                                <span th:case="${T(com.restaurant.store.entity.OrderStatus).PREPARING}">Our chefs are preparing your dishes with care.</span>
                                <span th:case="${T(com.restaurant.store.entity.OrderStatus).READY}">The order is ready for pickup and final checks.</span>
                                <span th:case="${T(com.restaurant.store.entity.OrderStatus).OUT_FOR_DELIVERY}">Our driver has left the store with your order.</span>
                                <span th:case="${T(com.restaurant.store.entity.OrderStatus).DELIVERED}">Enjoy your meal! The delivery has been completed.</span>
                                <span th:case="*">Stay tuned for the next update.</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="p-6 border-b border-gray-100 grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Order Items</h2>
                    <div class="space-y-3" th:attr="data-items-container=${order.id}">
                        <div th:each="item : ${order.orderItems}" class="flex items-center justify-between py-3 border-b border-gray-50 last:border-0">
                            <div class="flex items-center gap-3">
                                <img th:src="${item.productImageUrl != null ? item.productImageUrl : '/images/placeholder-food.jpg'}"
                                     th:alt="${item.productName}"
                                     class="w-12 h-12 rounded-lg object-cover"
                                     onerror="this.src='/images/placeholder-food.jpg'" />
                                <div>
                                    <p th:text="${item.productName}" class="font-medium text-gray-900"></p>
                                    <p class="text-sm text-gray-500">
                                        Qty <span th:text="${item.quantity}"></span>
                                        •
                                        <span th:text="${#numbers.formatDecimal(item.unitPrice, 0, 'COMMA', 0, 'POINT') + '៛'}"></span>
                                    </p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p th:text="${#numbers.formatDecimal(item.totalPrice, 0, 'COMMA', 0, 'POINT') + '៛'}" class="font-medium text-gray-900"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-900 mb-3">Payment Summary</h3>
                        <p class="text-sm text-gray-600">
                            Method:
                            <span class="font-medium"
                                  th:text="${order.paymentMethod != null ? #strings.replace(order.paymentMethod.name(), '_', ' ') : 'N/A'}"
                                  th:attr="data-payment-method=${order.id}"></span>
                        </p>
                        <p class="text-sm text-gray-600">
                            Status:
                            <span class="payment-badge"
                                  th:classappend="${order.paymentStatus != null} ? ' payment-' + order.paymentStatus : ''"
                                  th:text="${order.paymentStatus != null ? #strings.replace(order.paymentStatus.name(), '_', ' ') : 'N/A'}"
                                  th:attr="data-payment-status=${order.id}"></span>
                        </p>
                        <p class="text-sm text-gray-600" th:if="${order.paymentPaidAt != null}">
                            Paid on:
                            <span class="font-medium"
                                  th:text="${#temporals.format(order.paymentPaidAt, 'MMM dd, yyyy HH:mm')}"></span>
                        </p>
                        <p class="text-sm text-gray-600" th:if="${order.paymentTransactionId != null}">
                            Transaction ID:
                            <span class="font-medium" th:text="${order.paymentTransactionId}"></span>
                        </p>
                    </div>

                    <div class="bg-blue-50 rounded-lg p-4"
                         th:if="${order.orderType == T(com.restaurant.store.entity.OrderType).DELIVERY}"
                         th:attr="data-delivery-card=${order.id}">
                        <h3 class="font-semibold text-gray-900 mb-3">Delivery Status</h3>
                        <p class="text-sm text-gray-600">
                            Status:
                            <span class="font-medium"
                                  th:text="${order.deliveryStatus != null ? #strings.replace(order.deliveryStatus.name(), '_', ' ') : 'Pending'}"
                                  th:attr="data-delivery-status=${order.id}"></span>
                        </p>
                        <p class="text-sm text-gray-600">
                            Driver:
                            <span class="font-medium"
                                  th:text="${order.deliveryDriverName != null ? order.deliveryDriverName : 'Not assigned yet'}"
                                  th:attr="data-delivery-driver=${order.id}"></span>
                            <span class="text-gray-400"
                                  th:text="${order.deliveryDriverPhone != null ? '(' + order.deliveryDriverPhone + ')' : ''}"
                                  th:attr="data-delivery-phone=${order.id}"></span>
                        </p>
                        <p class="text-sm text-gray-600" th:if="${order.deliveryEstimatedArrivalTime != null}">
                            ETA:
                            <span class="font-medium" th:text="${#temporals.format(order.deliveryEstimatedArrivalTime, 'MMM dd, yyyy HH:mm')}"
                                  th:attr="data-delivery-eta=${order.id}"></span>
                        </p>
                        <p class="text-sm text-gray-600" th:if="${order.deliveryActualDeliveryTime != null}">
                            Delivered:
                            <span class="font-medium" th:text="${#temporals.format(order.deliveryActualDeliveryTime, 'MMM dd, yyyy HH:mm')}"></span>
                        </p>
                    </div>
                </div>
            </div>

            <div class="p-6 bg-gray-50 border-t border-gray-100 flex flex-wrap gap-4">
                <button onclick="window.location.href='/orders'"
                        class="px-6 py-3 bg-white border border-gray-300 text-gray-700 rounded-md font-medium hover:bg-gray-100 transition-colors">
                    Back to Orders
                </button>
                <form th:if="${order.status == 'PENDING' or order.status == 'CONFIRMED'}"
                      th:action="@{/orders/{orderId}/cancel(orderId=${order.id})}" method="post"
                      onsubmit="return confirm('Are you sure you want to cancel this order?');">
                    <button type="submit"
                            class="px-6 py-3 bg-red-600 text-white rounded-md font-medium hover:bg-red-700 transition-colors">
                        Cancel Order
                    </button>
                </form>
            </div>
        </div>
    </main>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 py-8" th:unless="${order}">
        <div class="text-center py-20">
            <div class="text-gray-400 mb-4">
                <svg class="w-24 h-24 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 011-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-600 mb-2">Order Not Found</h3>
            <p class="text-gray-500 mb-6">The order you're looking for doesn't exist or has been removed.</p>
            <button onclick="window.location.href='/orders'" class="bg-gray-900 text-white px-6 py-3 rounded-md font-medium hover:bg-gray-800 transition-colors">
                Back to Orders
            </button>
        </div>
    </main>

    <th:block th:replace="~{fragments/layout :: footer}"></th:block>
    <th:block th:replace="~{fragments/layout :: api-config}"></th:block>
    <th:block th:replace="~{fragments/layout :: auth-utils}"></th:block>

    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <script th:inline="javascript">
        const detailStatusClassMap = {
            'PENDING': 'status-PENDING',
            'CONFIRMED': 'status-CONFIRMED',
            'PREPARING': 'status-PREPARING',
            'READY': 'status-READY',
            'OUT_FOR_DELIVERY': 'status-OUT_FOR_DELIVERY',
            'COMPLETED': 'status-COMPLETED',
            'CANCELLED': 'status-CANCELLED',
            'DELIVERED': 'status-DELIVERED'
        };

        const trackingStatuses = ['PENDING', 'CONFIRMED', 'PREPARING', 'READY', 'OUT_FOR_DELIVERY', 'DELIVERED'];

        document.addEventListener('DOMContentLoaded', () => {
            const container = document.querySelector('[data-order-id]');
            if (!container) {
                return;
            }

            const orderId = container.dataset.orderId;
            const trackingContainer = document.querySelector(`[data-tracking="${orderId}"]`);
            if (trackingContainer) {
                updateTrackingSteps(orderId, trackingContainer.dataset.trackingStatus);
            }

            if (typeof SockJS === 'undefined' || typeof Stomp === 'undefined') {
                return;
            }

            const socket = new SockJS('/ws');
            const stompClient = Stomp.over(socket);
            stompClient.reconnect_delay = 5000;

            stompClient.connect({}, () => {
                stompClient.subscribe(`/topic/orders/${orderId}`, message => {
                    try {
                        const payload = JSON.parse(message.body);
                        updateOrderDetails(orderId, payload);
                    } catch (error) {
                        console.error('Failed to parse order update', error);
                    }
                });
                stompClient.subscribe(`/topic/orders/${orderId}/status`, message => {
                    updateOrderStatus(orderId, message.body);
                });
            }, error => {
                console.warn('Unable to connect to order updates', error);
            });
        });

        function updateOrderStatus(orderId, status) {
            const badge = document.querySelector(`[data-status-badge="${orderId}"]`);
            if (!badge || !status) {
                return;
            }
            badge.textContent = formatEnumValue(status) || status;
            badge.className = 'status-badge';
            badge.classList.add(detailStatusClassMap[status] || 'status-PENDING');

            updateTrackingSteps(orderId, status);
        }

        function updateOrderDetails(orderId, order) {
            if (!order) {
                return;
            }

            updateOrderStatus(orderId, order.status);

            updateTrackingSteps(orderId, order.status);

            if (order.updatedAt) {
                updateLastUpdated(orderId, order.updatedAt);
            }

            const paymentMethodEl = document.querySelector(`[data-payment-method="${orderId}"]`);
            if (paymentMethodEl) {
                paymentMethodEl.textContent = formatEnumValue(order.paymentMethod) || 'N/A';
            }

            const paymentStatusEl = document.querySelector(`[data-payment-status="${orderId}"]`);
            updatePaymentStatus(paymentStatusEl, order.paymentStatus);

            const deliveryStatusEl = document.querySelector(`[data-delivery-status="${orderId}"]`);
            if (deliveryStatusEl) {
                deliveryStatusEl.textContent = formatEnumValue(order.deliveryStatus) || 'Pending';
            }

            const deliveryEtaEl = document.querySelector(`[data-delivery-eta="${orderId}"]`);
            if (deliveryEtaEl) {
                if (order.deliveryEstimatedArrivalTime) {
                    deliveryEtaEl.textContent = formatDate(order.deliveryEstimatedArrivalTime);
                } else {
                    deliveryEtaEl.textContent = 'N/A';
                }
            }

            const driverNameEl = document.querySelector(`[data-delivery-driver="${orderId}"]`);
            if (driverNameEl) {
                driverNameEl.textContent = order.deliveryDriverName || 'Not assigned yet';
            }

            const driverPhoneEl = document.querySelector(`[data-delivery-phone="${orderId}"]`);
            if (driverPhoneEl) {
                driverPhoneEl.textContent = order.deliveryDriverPhone ? `(${order.deliveryDriverPhone})` : '';
            }
        }

        function updateTrackingSteps(orderId, status) {
            if (!orderId) {
                return;
            }

            const trackingContainer = document.querySelector(`[data-tracking="${orderId}"]`);
            if (!trackingContainer) {
                return;
            }

            if (status) {
                trackingContainer.dataset.trackingStatus = status;
            } else {
                status = trackingContainer.dataset.trackingStatus;
            }

            const steps = trackingContainer.querySelectorAll('[data-tracking-step]');
            if (!steps.length) {
                return;
            }

            const isCancelled = status === 'CANCELLED';
            const activeIndex = trackingStatuses.indexOf(status);

            steps.forEach((step, index) => {
                step.classList.remove('tracking-step-completed', 'tracking-step-active', 'tracking-step-upcoming', 'tracking-step-cancelled');

                if (isCancelled) {
                    if (index === 0) {
                        step.classList.add('tracking-step-cancelled');
                    } else {
                        step.classList.add('tracking-step-upcoming');
                    }
                    return;
                }

                if (activeIndex === -1) {
                    step.classList.add('tracking-step-upcoming');
                    return;
                }

                if (index < activeIndex) {
                    step.classList.add('tracking-step-completed');
                } else if (index === activeIndex) {
                    step.classList.add('tracking-step-active');
                } else {
                    step.classList.add('tracking-step-upcoming');
                }
            });

            updateTrackingDescription(orderId, status);
        }

        function updateLastUpdated(orderId, timestamp) {
            const container = document.querySelector(`[data-order-updated-container="${orderId}"]`);
            const label = document.querySelector(`[data-order-updated="${orderId}"]`);

            if (!container || !label) {
                return;
            }

            container.classList.remove('hidden');
            label.textContent = formatDate(timestamp);
        }

        function updateTrackingDescription(orderId, status) {
            const description = document.querySelector(`[data-tracking-description="${orderId}"]`);
            if (!description) {
                return;
            }

            if (status === 'CANCELLED') {
                description.textContent = 'This order was cancelled before completion.';
            } else {
                description.textContent = 'Follow your order from the kitchen to your door.';
            }
        }

        function formatDate(value) {
            try {
                const date = new Date(value);
                if (!isNaN(date.getTime())) {
                    return date.toLocaleString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }
            } catch (error) {
                console.warn('Unable to format date', value, error);
            }
            return value;
        }

        const detailPaymentStatusClassMap = {
            'PENDING': 'payment-PENDING',
            'PROCESSING': 'payment-PROCESSING',
            'COMPLETED': 'payment-COMPLETED',
            'FAILED': 'payment-FAILED',
            'CANCELLED': 'payment-CANCELLED',
            'REFUNDED': 'payment-REFUNDED'
        };

        function updatePaymentStatus(element, status) {
            if (!element) {
                return;
            }

            element.textContent = formatEnumValue(status) || 'N/A';
            element.className = 'payment-badge';

            if (status && detailPaymentStatusClassMap[status]) {
                element.classList.add(detailPaymentStatusClassMap[status]);
            }
        }

        function formatEnumValue(value) {
            if (!value) {
                return '';
            }

            return value
                .toString()
                .split('_')
                .map(part => part.charAt(0) + part.slice(1).toLowerCase())
                .join(' ');
        }
    </script>
</body>
</html>
