<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{fragments/layout :: head('Menu - Restaurant Store')}"></th:block>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Kantumruy Pro', sans-serif;
        }
        .tab-active {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
            color: white;
            font-weight: 600;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <th:block th:replace="~{fragments/layout :: header}"></th:block>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 py-8">

        <!-- Categories Navigation -->
        <div
            th:if="${categories.size() > 0}" class="mb-8 pb-2 overflow-x-auto"
        >
            <div class="flex gap-3 justify-center flex-wrap min-w-max mx-auto" hx-swap-oob="true">

                <!-- All Categories Button -->
                <a
                        th:href="@{/menu}"
                        th:class="${selectedCategoryId == null} ? 'tab-active px-6 py-3 rounded-full text-base font-medium transition-all duration-300 shadow-md hover:shadow-lg whitespace-nowrap' : 'bg-white text-gray-700 hover:bg-gray-100 px-6 py-3 rounded-full text-base font-medium transition-all duration-300 shadow-md hover:shadow-lg whitespace-nowrap'"
                >
                    All Categories
                </a>

                <!-- Individual Category Buttons -->
                <a th:each="category : ${categories}"
                        th:href="@{/menu(categoryId=${category.id})}"
                        th:class="${selectedCategoryId != null and selectedCategoryId == category.id} ? 'tab-active px-6 py-3 rounded-full text-base font-medium transition-all duration-300 shadow-md hover:shadow-lg whitespace-nowrap' : 'bg-white text-gray-700 hover:bg-gray-100 px-6 py-3 rounded-full text-base font-medium transition-all duration-300 shadow-md hover:shadow-lg whitespace-nowrap'"
                        th:text="${category.name}">
                </a>

            </div>
        </div>

        <div id="products-grid">
            <div th:replace="~{fragments/products-grid :: productsGrid(${products})}"></div>
        </div>
    </main>

    <th:block th:replace="~{fragments/layout :: footer}"></th:block>
    <th:block th:replace="~{fragments/layout :: api-config}"></th:block>
    <th:block th:replace="~{fragments/layout :: auth-utils}"></th:block>

    <script>
        // Product data for JavaScript functions
        const products = /*[[${products}]]*/ [];
        /** @var {Map<number,  {
             id: number;
             name: string;
             description: string;
             price: number;
             imageUrl: string;
             isAvailable: boolean;
             categoryId: number;
             categoryName: string;
         }>} productMap */
        const productMap = new Map(products.map(p => [p.id, p]));

        function openDetails(productId) {
            const product = productMap.get(productId);
            if (product) {
                localStorage.setItem('selectedProduct', JSON.stringify(product));
                window.location.href = `${PRODUCT_PAGE_BASE}${productId}`;
            }
        }

        function addToCart(productId) {
            const product = productMap.get(productId);
            if (!product || !product.isAvailable) return;

            let cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity = (existingItem.quantity || 1) + 1;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: 1,
                    imageUrl: product.imageUrl
                });
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartBadge();
            
            // Show success message (optional)
            showNotification('Added to cart!');
        }

        function showNotification(message) {
            // Simple notification implementation
            const notification = document.createElement('div');
            notification.className = 'fixed bottom-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 fade-in';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 2000);
        }
    </script>
</body>
</html>